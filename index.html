<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Nyra</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100vh;
        background: #111;
        color: white;
        font-family: sans-serif;
      }
      #navbar {
        background: #222;
        padding: 8px;
        display: flex;
      }
      #url {
        flex: 1;
        margin-left: 8px;
        padding: 6px;
        background: #333;
        color: white;
        border: none;
      }
      #viewer {
        width: 100%;
        height: calc(100vh - 40px);
        border: none;
      }
      #navbar button {
        background: #444;
        border: none;
        color: white;
        padding: 4px 10px;
        margin-right: 6px;
        cursor: pointer;
        border-radius: 4px;
      }

      #navbar button:hover {
        background: #666;
      }
    </style>
  </head>
  <body>
    <div id="navbar">
      <button id="back">←</button>
      <button id="forward">→</button>
      <input id="url" type="text" placeholder="Enter URL..." />
    </div>
    <webview
      id="viewer"
      src="https://duckduckgo.com"
      style="width: 100%; height: calc(100vh - 40px)"
      allowpopups
    ></webview>

    <script>
      const urlInput = document.getElementById("url");
      const viewer = document.getElementById("viewer");

      // Detect if the input is a search query or a URL
      const isLikelySearch = (text) => {
        const isLocal = /^localhost(:\d+)?$/.test(text);
        const isIP = /^\d{1,3}(\.\d{1,3}){3}(:\d+)?$/.test(text);
        const hasProtocol =
          text.startsWith("http://") || text.startsWith("https://");
        const looksLikeDomain = text.includes(".");

        return !hasProtocol && !isLocal && !isIP && !looksLikeDomain;
      };

      // Handle URL input on enter key press
      urlInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          let url = urlInput.value.trim();

          // Check if the URL is a search query or a regular URL
          if (isLikelySearch(url)) {
            url = "https://duckduckgo.com/?q=" + encodeURIComponent(url);
          } else if (!url.startsWith("http")) {
            url = "http://" + url;
          }

          viewer.src = url;
          urlInput.blur();
        }
      });

      viewer.addEventListener("page-title-updated", (e) => {
        document.title = e.title + " - Nyra";
      });

      // Handle URL input on change
      viewer.addEventListener("did-navigate-in-page", (e) => {
        urlInput.value = e.url;
      });

      viewer.addEventListener("did-navigate", (e) => {
        urlInput.value = e.url;
      });

      viewer.addEventListener("did-fail-load", (e) => {
        urlInput.value = viewer.src;
      });

      // Focus automatico al caricamento
      window.addEventListener("DOMContentLoaded", () => {
        urlInput.focus();
      });
      const backBtn = document.getElementById("back");
      const forwardBtn = document.getElementById("forward");

      // Back and forward button functionality
      backBtn.addEventListener("click", () => {
        if (viewer.canGoBack()) viewer.goBack();
      });

      forwardBtn.addEventListener("click", () => {
        if (viewer.canGoForward()) viewer.goForward();
      });
    </script>

    <script>
      // Set the initial URL to DuckDuckGo
      viewer.src = "https://duckduckgo.com";
    </script>
  </body>
</html>
